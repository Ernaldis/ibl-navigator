<div *ngIf="cells">
  <div class="cell-header">
    <h3>Cells</h3>
    <h6>(Total clusters for probe {{probeIndex}}: {{cellsByProbeIns.length}})</h6>
    <!-- <div class="quality-control-nav">&nbsp;Quality Control&nbsp;<span class="oi oi-external-link" routerLink="/qc/{{sessionInfo?.subject_uuid}}/{{sessionInfo?.session_start_time}}" [queryParams]="{nickname: ${sessionInfo?.subject_nickname}, lab: ${sessionInfo?.session_lab}, project: ${sessionInfo?.session_project}, protocol: ${sessionInfo?.task_protocol}}"></span></div> -->
    <div class="quality-control-nav">&nbsp;Quality Control&nbsp;<span class="oi oi-external-link" routerLink="/qc/{{sessionInfo?.subject_uuid}}/{{sessionInfo?.session_start_time}}" [queryParams]="{nickname: sessionInfo?.subject_nickname, lab: sessionInfo?.session_lab, project: sessionInfo?.session_project, protocol: sessionInfo?.task_protocol}"></span></div>

    <!-- <div class="quality-control-nav">&nbsp;Quality Control&nbsp;<span class="oi oi-external-link" routerLink="qc/{{sessionInfo?.subject_uuid}}/{{sessionInfo?.session_start_time}}?nickname=${sessionInfo?.subject_nickname}"></span></div> -->
  </div>
  <span class="cluster-nav-filters">
    <div class="probe-selection-area">
      <label for="probe_idx">Select Probe Insertion Index:&nbsp;&nbsp;  </label>
      <select name="probe_idx" (change)="probe_selected($event.target.value)">
        <option *ngFor="let probeIns of probeIndices" [value]="probeIns" [selected]="probeIns == probeIndices[0]">{{ probeIns }}</option>
      </select>
    </div>
    <div class="gc-filter-area">
      <label for="gc-filter">Select Good Cluster Criterion Filter:&nbsp;&nbsp;  </label>
      <select name="gc-filter" (change)="gcfilter_selected($event.target.value)">
        <option *ngFor="let gcfilter of gcfilter_types | keyvalue" [value]="gcfilter.key" [selected]="gcfilter == gcfilter_types[0]">{{ gcfilter.value }}</option>
      </select>
    </div>
  </span>
  <div *ngIf="probeTrajInfo && probeTrajInfo.LM">
    <b>LM</b>: {{probeTrajInfo.LM}}, <b>AP</b>: {{probeTrajInfo.AP}}, <b>z</b>: {{probeTrajInfo.z}}, <b>depth</b>: {{probeTrajInfo.depth}}, 
    <b>angle</b>: {{probeTrajInfo.angle}}, <b>hemisphere</b>: {{probeTrajInfo.hemisphere}}, <b>trajectory source</b>: {{probeTrajInfo.trajectory_source}}
  </div>
  <div *ngIf="!probeTrajInfo || !probeTrajInfo.LM">
    <p>No probe trajectory information found for the selected probe.</p>
  </div>
  <div *ngIf="goodClusters.length > 0">Good Clusters ({{goodClusters.length}})/ All Clusters ({{cellsByProbeIns.length}})</div>
  <div class="row">
    <div class="cluster-nav-plot-area col-7 col-xl-5">
      <br>
      <plotly-plot [data]="plot_data" [layout]="plot_layout" [config]="plot_config" (restyle)="restylePlot($event)" (click)="clusterSelectedPlot($event)"></plotly-plot>
    </div>
    <div class="depth-peth-plot-area col-4 col-xl-4" *ngIf="depthPethLookup[eventType]['layout']">
      <div class="order-buttons col-10">
        
        <div class="order-button-content">
          <label for="event"><b>Event</b></label>
          <div class="radio-option">
            <input type="radio" name="depthPETHevent" id="stim on" value="stim on" [checked]="eventType === 'stim on'" (change)="order_by_event($event.target.value)">
            <label for="stim on">Stim On</label>
          </div>
          <div class="radio-option">
            <input type="radio" name="depthPETHevent" id="feedback" value="feedback" [checked]="eventType === 'feedback'" (change)="order_by_event($event.target.value)">
            <label for="feedback">Feedback</label>
          </div>
          
        </div>  
      </div>
      <div>
        <plotly-plot [data]="depthPethLookup[eventType]['data']" [layout]="depthPethLookup[eventType]['layout']" [config]="depthPethLookup[eventType]['config']"></plotly-plot> 
      </div>
    </div>
    <div class="plots-navigator" *ngIf="showController">
      <div *ngIf="cells" class="clusterListContainer">
        <table matSort (matSortChange)="sortData($event)" class="table table-sm table-hover col-5 ml-auto clusterListTable" #navTable>
        <!-- <table class="table table-sm table-hover col-5 ml-auto clusterListTable" #navTable> -->
          <thead class="thead-light">
            <th mat-sort-header="cluster_id">Cluster ID</th>
            <th>Probe Index</th>
            <th mat-sort-header="cluster_depth">Cluster Depth (µm)</th>
            <th mat-sort-header="cluster_amp">Cluster Amp (µV)</th>
            <th mat-sort-header="firing_rate">Firing Rate</th>
            <!-- <th>Details</th> -->
          </thead>
          <tbody>
            <!-- <tr *ngFor="let cl of cellsByProbeIns" (click)="clusterSelectedTable(cl.cluster_id)" [ngStyle]="{'backgroundColor': cl?.cluster_id == clickedClusterId ? '#ffe5e5' : ''}"> -->
            <tr *ngFor="let cl of sortedCellsByProbeIns" (click)="clusterSelectedTable(cl.cluster_id)" [ngStyle]="{'backgroundColor': cl?.cluster_id == clickedClusterId ? '#ffe5e5' : '', 'color': !goodClusters.includes(cl?.cluster_id) && goodClusters.length ? 'lightgrey' : ''}">

              <td>{{ cl.cluster_id }}</td>
              <td>{{ cl.probe_idx }}</td>
              <td>{{ cl.cluster_depth }}</td>
              <td>{{ cl.cluster_amp * 1000000 | number:'0.0-3'}}</td>
              <td>{{ cl.firing_rate | number:'0.0-3'}}</td>
              <!-- <td>
                <span class="oi oi-external-link" routerLink="/cell/{{cl?.subject_uuid}}/{{cl?.session_start_time}}/{{cl?.cluster_id}}">
                  <div hidden>
                    <td>{{ cl.cluster_id }}</td>
                    <td>{{ cl.probe_idx }}</td>
                    <td>{{ cl.cluster_depth }}</td>
                    <td>{{ cl.cluster_amp }}</td>
                  </div>
                </span>
              </td> -->
            </tr>
          </tbody>
        </table>
      </div>
      <div class="plots-navigator-buttons">
        <h3><span class="oi oi-arrow-circle-top" (click)="navigate_cell_plots($event, 'up')"></span></h3>
        <h3><span class="oi oi-arrow-circle-bottom" (click)="navigate_cell_plots($event, 'down')"></span></h3>
      </div>
    </div>

    <div class="rasterPlotSelectors col-8">
      <div class="order-buttons col-4">
        <label for="event"><b>Event</b></label>
        <!-- <select name="event" (change)="order_by_event($event.target.value)">
          <option value="feedback" [selected]="eventType === 'feedback'">Feedback</option>
          <option value="stim on" [selected]="eventType === 'stim on'">Stim On</option>
        </select> -->
        <div class="order-button-content">
          <div class="radio-option">
            <input type="radio" name="event" id="stim on" value="stim on" [checked]="eventType === 'stim on'" (change)="order_by_event($event.target.value)">
            <label for="stim on">Stim On</label>
          </div>
          <div class="radio-option">
            <input type="radio" name="event" id="feedback" value="feedback" [checked]="eventType === 'feedback'" (change)="order_by_event($event.target.value)">
            <label for="feedback">Feedback</label>
          </div>
        </div>  
      </div>
      <div class="order-buttons col-8">
        <label for="sort_by"><b>Sort By</b></label>
        <!-- <select name="sort_by" (change)="order_by_sorting($event.target.value)">
          <option value="trial_id" [selected]="sortType === 'trial_id'">Trial ID</option>
          <option value="feedback - stim on" [disabled]="eventType==='feedback'" [selected]="sortType === 'feedback - stim on'">Feedback - Stim On</option>
          <option value="contrast" [disabled]="eventType==='feedback'" [selected]="sortType === 'contrast'">Contrast</option>
          <option value="feedback type" [disabled]="eventType==='stim on'" [selected]="sortType === 'feedback type'">Feedback Type</option>
        </select> -->
        <div class="order-button-content">
          <div class="radio-option">
            <input type="radio" name="sort_by" id="trial_id" value="trial_id" [checked]="sortType === 'trial_id'" (change)="order_by_sorting($event.target.value)">
            <label for="trial_id">Trial ID</label>
          </div>
          <div class="radio-option">
            <input type="radio" name="sort_by" id="feedback - stim on" value="feedback - stim on" [disabled]="eventType==='feedback'" [checked]="sortType === 'feedback - stim on'" (change)="order_by_sorting($event.target.value)">
            <label for="feedback - stim on" [style.color]="eventType==='feedback' ? 'lightgrey' : ''">Feedback - Stim On</label>
          </div>
          <div class="radio-option">
            <input type="radio" name="sort_by" id="contrast" value="contrast" [disabled]="eventType==='feedback'" [checked]="sortType === 'contrast'" (change)="order_by_sorting($event.target.value)">
            <label for="contrast" [style.color]="eventType==='feedback' ? 'lightgrey' : ''">Contrast</label>
          </div>
          <div class="radio-option">
            <input type="radio" name="sort_by" id="feedback type" value="feedback type" [disabled]="eventType==='stim on'" [checked]="sortType === 'feedback type'" (change)="order_by_sorting($event.target.value)">
            <label for="feedback type" [style.color]="eventType==='stim on' ? 'lightgrey' : ''">Feedback Type</label>
          </div>
        </div>
      </div>
    </div>
  
  
    <!-- <plotly-plot [data]="raster_data[clickedClusterId]" [layout]="raster_layout[clickedClusterId]" [config]="raster_config[clickedClusterId]"></plotly-plot>  -->
    <div class="row">
      <div *ngIf="rasterLookup[clickedClusterId]">
        <plotly-plot [data]="rasterLookup[clickedClusterId]['data']" [layout]="rasterLookup[clickedClusterId]['layout']" [config]="rasterLookup[clickedClusterId]['config']"></plotly-plot> 
      </div>
      
      <div *ngIf="psthLookup[clickedClusterId]">
        <plotly-plot [data]="psthLookup[clickedClusterId]['data']" [layout]="psthLookup[clickedClusterId]['layout']" [config]="psthLookup[clickedClusterId]['config']"></plotly-plot> 
      </div>
    </div>

    <div class="row-long">
      <div *ngIf="autocorrelogramLookup[clickedClusterId]">
        <plotly-plot [data]="autocorrelogramLookup[clickedClusterId]['data']" [layout]="autocorrelogramLookup[clickedClusterId]['layout']" [config]="autocorrelogramLookup[clickedClusterId]['config']"></plotly-plot> 
      </div>
      
      <div *ngIf="spikeAmpTimeLookup[clickedClusterId]">
        <plotly-plot [data]="spikeAmpTimeLookup[clickedClusterId]['data']" [layout]="spikeAmpTimeLookup[clickedClusterId]['layout']" [config]="spikeAmpTimeLookup[clickedClusterId]['config']"></plotly-plot> 
      </div>

      <div *ngIf="waveformLookup[clickedClusterId]">
        <plotly-plot [data]="waveformLookup[clickedClusterId]['data']" [layout]="waveformLookup[clickedClusterId]['layout']" [config]="waveformLookup[clickedClusterId]['config']"></plotly-plot> 
      </div>
    </div>

    <br>
  </div>
  <hr>
  <div>
    <div *ngIf="depthRasterTrialLookup[probeIndex]">
      <h5>Trial Depth Raster</h5>
      <div class="row">
        <label><b>Trial Type:&nbsp;</b>&nbsp;&nbsp;</label>
        <div class="radio-option" (change)="trialTypeSelected($event.target.value)">
          <input type="radio" value="Correct Left Contrast" [checked]="selectedTrialType == 'Correct Left Contrast'"><label>Correct Left &nbsp;&nbsp;</label>
          <input type="radio" value="Correct Right Contrast" [checked]="selectedTrialType == 'Correct Right Contrast'"><label>Correct Right &nbsp;&nbsp;</label>
          <input type="radio" value="Incorrect Left Contrast" [checked]="selectedTrialType == 'Incorrect Left Contrast'"><label>Incorrect Left &nbsp;&nbsp;</label>
          <input type="radio" value="Incorrect Right Contrast" [checked]="selectedTrialType == 'Incorrect Right Contrast'"><label>Incorrect Right</label>
        </div>
      </div>
      <!-- sliding through trial IDs, trialContrast NOT differentiated (for smaller batch of generated trial depth rasters) --> 
      <plotly-plot (sliderChange)="flipTrialContrast($event)" [data]="sliderDepthRasterTrialLookup[probeIndex][selectedTrialType][selectedTrialContrast]['data']" [layout]="sliderDepthRasterTrialLookup[probeIndex][selectedTrialType][selectedTrialContrast]['layout']" [config]='raster_psth_config'></plotly-plot>

      <hr>
      <p style="color:red;">DEV SAMPLE: Once there are multiple trial raster plots per contrast, the slider will show/go through the trial IDs</p>
      <div class="row">
        <label><b>Trial Contrast:&nbsp;</b>&nbsp;&nbsp;</label>
        <div *ngIf="sliderDepthRasterTrialLookup && sliderDepthRasterTrialLookup[probeIndex][selectedTrialType]">
          <div class="radio-option trial-contrast-options" (change)="trialContrastSelected($event.target.value)" >
            <div *ngFor="let contrast of availableTrialContrasts">
              <input type="radio" value="{{contrast}}" [checked]="selectedTrialContrast == contrast"><label>{{contrast}} &nbsp;&nbsp;</label>
            </div>
          </div>
        </div>
      </div>

      <!-- sliding through trial IDs, trialContrast differentiated (for larger batch of generated trial depth rasters in the future) --> 
      <plotly-plot (sliderChange)="flipTrialID_B($event)" [data]="sliderDepthRasterTrialLookupB[probeIndex][selectedTrialType][selectedTrialContrast][featuredTrialId]['data']" [layout]="sliderDepthRasterTrialLookupB[probeIndex][selectedTrialType][selectedTrialContrast][featuredTrialId]['layout']" [config]='raster_psth_config'></plotly-plot>
      
    </div>
  </div>

</div>
